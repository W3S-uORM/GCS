$(document).ready(function () { function h(b) { if (b.success) if (0 != b.totalCount) { g(b); void 0 != $(a.elements.loadmore) && "button" == a.settings.loadMoreSetUp.toLowerCase() && l(); if (void 0 != $(a.elements.pagination) && "pagination" == a.settings.loadMoreSetUp.toLowerCase()) { var c = b.pagination; $(a.elements.pagination).show(); $(a.elements.pagination).html(c) } "infinite" == a.settings.loadMoreSetUp.toLowerCase() && m(b); n(b); p(b) } else a.settings.showSpelling && null != b.spelling && "" != b.spelling ? a.settings.showSpelling && ($(a.elements.spelling).show(), c = $(a.elements.spelling).find(".gcs_spelling_append"), 0 >= c.length ? $(a.elements.spelling).append("<span class='gcs gcs_spelling_append'>" + b.spelling + "</span>") : $($(c)[0]).html(b.spelling)) : $(a.elements.no_results).show(); else $(a.elements.error).html("An error has occured. Please check your settings.") } function q() { $(a.elements.input).on("keypress", function (b) { 13 == (b.keyCode || b.which) && (document.location.href = a.redirectpath + "?gcs_q=" + $(this).val()) }); $(a.elements.btn).on("click", function () { var b = $(this).siblings(".gcs_input"); document.location.href = a.redirectpath + "?gcs_q=" + b.val() }) } function p(b) { $(".gcs__result__link").on("click", function () { a.resources.saveQuery({ Id: b.queryId, ClickURL: $(this).attr("href"), ClickTitle: $(this).attr("data-title") }) }) } function n(b) { if (a.settings.showFilterFileType) { $(a.elements.filter_filetype_select).show(); var c = $(a.elements.filter_filetype_select).find("select"), d = $(a.elements.filter_filetype_select).attr("data-first-option"); 0 >= c.length && $(a.elements.filter_filetype_select).append("<div class='gcs gcs_filetype_filter_select'>" + b.filetypefilter + "</div>"); "" != a.fileTypeFilter && $(".gcs_filetype_filter_select select").val(a.fileTypeFilter); $($(".gcs_filetype_filter_select option")[0]).html(d); $(a.elements.filter_filetype_select).change(function () { a.fileTypeFilter = $(".gcs_filetype_filter_select option:selected").val(); f(); a.resources.performSearch(a.query, a.startIndex).then(function (b) { $(a.elements.results).html(""); h(b); k() }) }) } } function g(b) { $(a.elements.results).append(b.list); if (a.settings.showQuery) { $(a.elements.query).show(); var c = $(a.elements.query).find(".gcs_query_append"); 0 >= c.length ? $(a.elements.query).append("<span class='gcs gcs_query_append'>" + a.query + "</span>") : $($(c)[0]).html(a.query) } a.settings.showTiming && ($(a.elements.timing).show(), c = $(a.elements.timing).find(".gcs_timing_append"), 0 >= c.length ? $(a.elements.timing).append("<span class='gcs gcs_timing_append'>" + b.timing + "s. </span>") : $($(c)[0]).html(a.timing)); a.settings.showTotalCount && ($(a.elements.results_count).show(), c = $(a.elements.results_count).find(".gcs_totalcount_append"), 0 >= c.length ? $(a.elements.results_count).append("<span class='gcs gcs_totalcount_append'>" + b.totalCount + "</span>") : $($(c)[0]).html(a.totalCount)); a.settings.keepquery && $(a.elements.input).val(a.query); "" == b.spelling && $(a.elements.spelling).hide(); a.settings.showThumbnail ? $.each($(".gcs__result__thumnail"), function (b, c) { "none" == $(c).css("background-image") && $(c).css({ "background-image": "url('" + a.settings.thumbnailFallback + "')" }) }) : $.each($(".gcs__result__thumnail"), function (a, b) { $(b).hide() }); "button" == a.settings.loadMoreSetUp.toLowerCase() && (a.startIndex + a.itemsPerPage >= b.totalCount || b.totalCount <= a.itemsPerPage ? $(a.elements.loadmore).hide() : $(a.elements.loadmore).show()); "pagination" == a.settings.loadMoreSetUp.toLowerCase() && (b.totalCount < a.itemsPerPage ? $(a.elements.pagination).hide() : $(a.elements.pagination).show()) } function l() { $(a.elements.loadmore).show(); $(a.elements.loadmore).on("click", function () { a.startIndex += a.itemsPerPage; f(); a.resources.performSearch(a.query, a.startIndex).then(function (a) { g(a); hiderLoader() }) }) } function m(b) { $(a.elements.infinitescroll).show(); var c = $(a.elements.results)[0].getBoundingClientRect(), d = !1; $(window).on("scroll", function (e) { c = $(a.elements.results)[0].getBoundingClientRect(); !d && $(window).scrollTop() > c.bottom && (a.startIndex = Number(a.startIndex) + a.itemsPerPage, 1 != d && a.startIndex < b.totalCount && (f(), a.resources.performSearch(a.query, a.startIndex).then(function (a) { g(a); d = !1; hiderLoader() })), d = !0) }) } function f() { a.settings.preloaderIcon && "" != a.settings.preloaderIcon ? ($(a.elements.preloader).css({ display: "block" }), $(a.elements.preloader_img).attr("src", a.settings.preloaderIcon)) : $(a.elements.preloader).css({ display: "none" }) } function k() { $(a.elements.preloader).css({ display: "none" }) } function e(a) { a = a.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); return (a = location.search.match(new RegExp("[?&]" + a + "=([^&]+)(&|$)"))) && decodeURIComponent(a[1].replace(/\+/g, " ")) } var a = { elements: { query: $(".gcs_searchquery"), timing: $(".gcs_timing"), input: $(".gcs_input"), btn: $(".gcs_btn"), no_results: $(".gcs_no-results"), results: $(".gcs_results"), preloader: $(".gcs__preloadericon"), preloader_img: $(".gcs__preloadericon img"), results_count: $(".gcs_results_count"), loadmore: $(".gcs_loadmore"), pagination: $(".gcs_pagination"), infinitescroll: $(".gcs_infinite_scroll"), filter_filetype_select: $(".gcs_filetype_filter_select"), spelling: $(".gcs_spelling"), didyoumean: $(".gcs_didyoumean"), error: $(".gcs_error") }, startIndex: 1, redirectpath: null, itemsPerPage: null, query: null, fileTypeFilter: "", docTypeFilter: "", resources: { getSettings: function () { return $.post("/umbraco/surface/GCSSettings/Get", { model: { CurrentURL: window.location.host + window.location.pathname } }) }, performSearch: function (b, c) { return $.post("/umbraco/surface/GCSearch/Get", { model: { Query: b, StartIndex: c, Filetype: a.fileTypeFilter, Section: a.docTypeFilter, CurrentNodeID: a.settings.currentNodeId } }) }, saveQuery: function (a) { return $.post("/umbraco/surface/GCSQueries/UpdateClick", { model: a }) } }, settings: {} }; $(a.elements.loadmore).hide(); $(a.elements.pagination).hide(); $(a.elements.infinitescroll).hide(); $(a.elements.timing).hide(); $(a.elements.results_count).hide(); $(a.elements.query).hide(); $(a.elements.no_results).hide(); $(a.elements.spelling).hide(); $(a.elements.filter_filetype).hide(); $(a.elements.filter_documenttype).hide(); a.resources.getSettings().then(function (b) { var c = e("startIndex"); a.settings = b; a.redirectpath = a.settings.redirectPath; a.itemsPerPage = a.settings.itemsPerPage; a.query = e("gcs_q"); a.fileTypeFilter = e("gcs_ftype"); a.docTypeFilter = e("gcs_sect"); a.startIndex = void 0 != c && "" != c ? c : a.startIndex; q(); $($(a.elements.results)[0]).is(":empty") && "" != a.query && void 0 != a.query && null != a.query && (f(), a.resources.performSearch(a.query, a.startIndex).then(function (a) { h(a); k() })) }) });